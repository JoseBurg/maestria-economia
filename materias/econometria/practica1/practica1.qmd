---
title: Análisis Econométrico
subtitle: "Práctica 1: Econometría"
author: "José Burgos"
format: 
  pdf:
    include-in-header: 
      text: |
        \usepackage{float}
    echo: false
    warning: false
    message: false
editor: visual
---

**Ejercicio 1: Considere la base de datosBase *ENCFT 20161 – 20164.xlsx* que contiene información sobre el lado de la oferta del mercado de trabajo.**

a)  Importe la información a R, creando las bases de datos correspondientes.

b)  Adjunte el módulo de MIEMBROS y el de OCUPACIÓN, creando una variable `id` que concatene la información de la vivienda, el hogar y el miembro, de modo que en una misma base de datos queden las características de los individuos y las variables de mercado laboral.

```{r}
library(dplyr)
library(ggplot2)
encft <- readr::read_csv("datos/encft2016.csv") |> 
  janitor::clean_names()
```

c)  Cree la variable `EDAD` y `MUJER`, donde esta última sea igual a 1 si el individuo es mujer y 0 en caso contrario.

```{r}
#| echo: true
encft <- encft |> 
  mutate(
    #Cuestionario: mujer = 2 y hombre = 1 
    mujer = ifelse(sexo == 2, 1, 0)
  )
```

d)  Usando histogramas, grafique la distribución de la **edad** por **género**.

```{r plot_genero_edad}
encft |> 
  mutate(
    mujer = factor(mujer, levels = c(0, 1),
                   labels = c("Hombre", "Mujer"))) |> 
  ggplot(aes(x = edad, fill = mujer)) + 
  geom_histogram(bins = 30, alpha = 0.8, position = "identity") +
  scale_fill_manual(
    name   = "Género",
    values = c("Hombre" = "#1f78b4", "Mujer" = "#e31a1c"),
    labels = c("Hombre", "Mujer")) +
  facet_wrap(~ mujer) +
  labs(
    title    = "Distribución de edad por género",
    x        = "Edad",
    y        = "Frecuencia") +
  theme_light() +
  theme(
    legend.position = "none",
    panel.grid = element_blank()
  )
```

e)  Cree la variable salario por hora (`W`) utilizando la información de ingreso laboral en la ocupación principal. Tenga en cuenta que el ingreso reportado en la base de datos no está necesariamente en la misma escala para todos los individuos (p. ej., algunos reportan salario por hora, otros por mes, etc.).

f)  Muestre en una tabla la distribución de edad por percentil de ingreso. *En particular, reporte los percentiles 5, 25, 50, 75 y 95.*

<!-- -->

2.  Para el caso del modelo de regresión lineal, muestre las propiedades de muestra finita del estimador de mínimos cuadrados.

    **Propiedades de muestra finita:**

    1.  **Insesgadez**: $$\hat{\beta}=(X'X)^{-1}X'y\ \rightarrow\ E[\hat\beta|X]=\beta$$ *por expectativas iteradas* $E[\hat\beta]=\beta$. Esto demuestra que, para cualquier muestra (de tamaño $n>_-$), el estimador de MCO está centrado en el valor verdadero del parámetro.

    2.  **Varianza condicional**

    $$Var(\hat\beta|X)=Var[(X'X)^{-1}X'\epsilon|X]=\sigma^2(X'X)$$ De aquí se obtienen las varianzas individuales y las covarainzas entre componentes de $\hat\beta$.

    3.  **Insesgadez del estimados de** $\sigma^2$

    El estiamdor habitual de la varianza del error es:

    $$s^2 = \frac{e'e}{n-(k+1)},\ \ \ \ \ \ \ e = y-X\hat\beta$$ Bajo los supuestos clásicos se tiene $E[s^2|X]=\sigma^2$, es decir, $s^2$ es insesgado para $\sigma^2$ en muestras finitas.

    4.  **Optimalidad (Teorema de Gauss-Markov)**

3.  **Modelo de regresión lineal** $$ y = \alpha + \beta x + \varepsilon$$

<!-- -->

a)  Muestre que las ecuaciones normales de mínimos cuadrados implican que $\sum_i e_i = 0$ y que $\sum_i x_i e_i = 0$.

Demostracion: Para demostrar que las ecuaciones normales de mínimos cuadrados implican que $\sum_i e_i = 0$ y $\sum_i x_i e_i = 0$, partimos de la definición del error $e_i = y_i - \hat{y}_i$, donde $\hat{y}_i$ es la predicción del modelo.

La ecuación de regresión lineal es:

b)  Muestre que la solución para el término constante es:: $\hat{\alpha} = \bar y - b\bar x$.

c)  Muestre que la solución para $b$ es $b = \frac{\sum_{i=1}^n (x_i - \bar x)(y_i - \bar y)} {\sum_{i=1} (x_i - \bar x)^2}$

<!-- -->

6.  Los datos en el archivo *KoopandTobias2004.xls* son una extracción de 15 observaciones de una muestra de 2,178 individuos de un conjunto de variables. Sea $X1$ igual a la constante, educación, experiencia y habilidad. Mientras que sea $X2$ igual a la eduación de la madre, la educación del padre, y el número de hermanos. Sea y el salario.

<!-- -->

```{r}
koopand <- readxl::read_xls("datos/KoopandTobias2004.xls") |> 
  janitor::clean_names()
```

a)  Compute los coeficientes de MCO en la regresión de y sobre X1. Reporte los coeficientes.

**Modelo:**

$$wage = \beta_0 + \beta_1education+\beta_2experience+\beta_3ability+\epsilon$$

```{r}
#| echo: true
modelo1 <- lm(wage ~ education + experience + ability, data = koopand)

gtsummary::tbl_regression(modelo1, intercept = TRUE)
```

b)  Compute los coeficientes de MCO en la regresión de y sobre X1 y X2. Reporte los coeficientes.

c)  Regrese cada una de las tres variables en X2 sobre todas las variables en X1. Estas nuevas variables denótenlas como $X^∗_2$ ¿Cuáles son las medias muestrales de estas variables? Explique el resultado.

<!-- -->

7.  Suponga que usted tiene dos estimadores insesgados e independientes del mismo parámetro $\theta$, por ejemplo $\hat{\theta}_1$ y $\hat{\theta}_2$, con la varianzas diferentes $v_1$ y $v_2$. Qué combinacón lineal $\hat{\theta}=c_1\hat{\theta_1}+c_2\hat{\theta_2}$ es el estimador insesgado de varianza mínima?

Respuesta:

Para que $\hat{\theta}$ sea insesgado, se debe cumplir que $E[\hat{\theta}] = \theta$. Dado que ambos estimadores son insesgados, tenemos:

$$E[\hat{\theta}] = c_1 E[\hat{\theta}_1] + c_2 E[\hat{\theta}_2] = c_1 \theta + c_2 \theta = (c_1 + c_2) \theta$$

Para que $\hat{\theta}$ sea insesgado, necesitamos que $c_1 + c_2 = 1$.

Para minimizar la varianza de $\hat{\theta}$, utilizamos la propiedad de que la varianza de una combinación lineal de variables aleatorias independientes es la suma de las varianzas individuales:

$$Var(\hat{\theta}) = Var(c_1 \hat{\theta}_1 + c_2 \hat{\theta}_2) = c_1^2 Var(\hat{\theta}_1) + c_2^2 Var(\hat{\theta}_2) = c_1^2 v_1 + c_2^2 v_2$$

Para minimizar esta varianza bajo la restricción $c_1 + c_2 = 1$, podemos usar el método de Lagrange. Definimos la función objetivo:

$$L(c_1, c_2, \lambda) = c_1^2 v_1 + c_2^2 v_2 + \lambda (c_1 + c_2 - 1)$$ Luego, derivamos respecto a $c_1$, $c_2$ y $\lambda$ y igualamos a cero:

$$\frac{\partial L}{\partial c_1} = 2c_1 v_1 + \lambda = 0$$ $$\frac{\partial L}{\partial c_2} = 2c_2 v_2 + \lambda = 0$$ $$\frac{\partial L}{\partial \lambda} = c_1 + c_2 - 1 = 0$$ Resolviendo este sistema de ecuaciones, obtenemos:

$$c_1 = \frac{v_2}{v_1 + v_2}$$ $$c_2 = \frac{v_1}{v_1 + v_2}$$
